<div class="container">
  <h1 class="page-title">Gestión de Divisiones Académicas</h1>

  <p-toolbar>
    <div class="p-toolbar-group-left">
      <button 
        pButton 
        label="Nuevo" 
        icon="pi pi-plus" 
        class="p-button-success" 
        (click)="openNewModal()"
      ></button>
    </div>
  </p-toolbar>
  
  <p-table
    [value]="divisiones"
    [paginator]="true"
    [rows]="rows"
    [first]="first"
    [responsiveLayout]="'scroll'"
    [rowsPerPageOptions]="[10, 20, 30]"
    (onPage)="onPageChange($event)"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Id</th>
        <th>Nombre</th>
        <th>Estado</th>
        <th>Programas Educativos</th>
        <th>Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-div>
      <tr>
        <td>{{ div.id }}</td>
        <td>{{ div.nombre }}</td>
        <td>
          <span
            [ngClass]="{'status-active': div.estado, 'status-inactive': !div.estado}"
          >
            {{ div.estado ? 'Activo' : 'Inactivo' }}
          </span>
        </td>
        <td>
          <ul>
            <li *ngFor="let pe of div.programasEducativos">{{ pe.nombre }}</li>
          </ul>
        </td>
        <td class="action-buttons">
          <button
            pButton
            icon="pi pi-pencil"
            class="p-button-rounded p-button-success p-mr-2"
            (click)="openEditModal(div)"
          ></button>
          
          <button
            pButton
            icon="pi pi-trash"
            class="p-button-rounded p-button-danger"
            (click)="deleteDivision(div)"
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>


<p-dialog 
    [header]="'Editar División: ' + (selectedDivision?.nombre || '')" 
    [(visible)]="displayEditModal" 
    [modal]="true" 
    [style]="{ width: '50vw', minWidth: '300px' }"
    [baseZIndex]="10000" 
    (onHide)="closeEditModal()" 
    [resizable]="false"
>
    <div class="p-fluid" *ngIf="selectedDivision">
        <div class="field mb-4">
            <label for="edit_nombre">Nombre de la División</label>
            <input id="edit_nombre" type="text" pInputText [(ngModel)]="selectedDivision.nombre" />
        </div>
        
        <div class="field-checkbox flex align-items-center">
            <p-checkbox id="edit_estado" [(ngModel)]="selectedDivision.estado" binary="true"></p-checkbox>
            <label for="edit_estado" class="ml-2">División Activa</label>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <p-button label="Cancelar" icon="pi pi-times" (click)="closeEditModal()" styleClass="p-button-text"></p-button>
        <p-button label="Guardar Cambios" icon="pi pi-check" (click)="saveChanges()" styleClass="p-button-primary"></p-button>
    </ng-template>
</p-dialog>

<p-dialog 
    header="Registrar Nueva División" 
    [(visible)]="displayNewModal" 
    [modal]="true" 
    [style]="{ width: '40vw', minWidth: '250px' }"
    [baseZIndex]="10000" 
    (onHide)="displayNewModal = false" 
    [resizable]="false"
>
    <div class="p-fluid">
        <div class="field mb-4">
            <label for="new_nombre">Nombre de la División</label>
            <input 
                id="new_nombre" 
                type="text" 
                pInputText 
                [(ngModel)]="newDivision.nombre"
            />
        </div>
        
        <div class="field-checkbox flex align-items-center">
            <p-checkbox id="new_estado" [(ngModel)]="newDivision.estado" binary="true"></p-checkbox>
            <label for="new_estado" class="ml-2">División Activa</label>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <p-button 
            label="Cancelar" 
            icon="pi pi-times" 
            (click)="displayNewModal = false" 
            styleClass="p-button-text"
        ></p-button>
        <p-button 
            label="Guardar Nueva" 
            icon="pi pi-save" 
            (click)="saveNewDivision()" 
            [disabled]="!newDivision.nombre"
            styleClass="p-button-success"
        ></p-button>
    </ng-template>
</p-dialog>